@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import play.api.i18n._
@import models.ExistingProtectionDisplayModel
@import config.FrontendAppConfig
@import views.HeaderContent
@import common.Strings
@import views.html.playHelpers.templates.existingProtections.protectionDetails

@this(appConfig: FrontendAppConfig)

@(protection: ExistingProtectionDisplayModel, statusGroup: String, protectionNum: Int)(implicit messages: Messages)

@changeLink = {
    @protection.amendCall.map{ call =>
        <a class="govuk-body govuk-link" href="@call" id=@{s"${protection.status.toLowerCase}-${Strings.protectionTypeString(Some(protection.protectionType))}-amend-link-$protectionNum"}>
            @Messages("pla.existingProtections.amendLinkText")
            <span class="govuk-visually-hidden">
                @Messages("pla.protection.types." + protection.protectionType) @protection.protectionReference
            </span>
        </a>
    }
}

<h3 class="govuk-heading-m" id="activeProtection">
    @Messages("pla.protection.types." + protection.protectionType)
    <span class="govuk-visually-hidden">
        @Messages("pla.hidden.activeProtection")
    </span>
</h3>
<dl class="govuk-summary-list">

    @protection.protectedAmount.map { protectedAmount =>
        @protectionDetails(Messages(HeaderContent.getProtectedLifetimeAllowance(appConfig)), protectedAmount, "activeProtectedAmount", Some(changeLink))
    }

    @protectionDetails(Messages(HeaderContent.getProtectionNotificatioNumber(appConfig)), protection.protectionReference, "activeProtectionReference")

    @protection.psaCheckReference.map { checkRef =>
        @protectionDetails(Messages(HeaderContent.getSchemeAdministratorReference(appConfig)), checkRef, "activePSACheckRef")
    }

    @protection.certificateDate.map{ certificateDate =>
        @protectionDetails(Messages("pla.existingProtections.applicationDate"), certificateDate, "activeCertificateDate")
    }

    @protection.certificateTime.map{ certificateTime =>
        @protectionDetails(Messages("pla.existingProtections.applicationTime"), certificateTime, "activeCertificateTime")
    }

    @protection.lumpSumPercentage.map { lumpSumPercentage =>
        @protectionDetails(Messages("pla.existingProtections.lumpSumPercentage"), lumpSumPercentage, "activeLumpSumPercentage")
    }

    @protection.lumpSumAmount.map{ lumpSumAmount =>
        @protectionDetails(Messages("pla.existingProtections.lumpSumAmount"), lumpSumAmount, "activeLumpSumAmount")
    }

    @protection.enhancementFactor.map{ enhancementFactor =>
        @protectionDetails(Messages("pla.existingProtections.enhancementFactor"), enhancementFactor, "activeEnhancementFactor")
    }

    @protection.factor.map{ factor =>
        @protectionDetails(Messages("pla.existingProtections.factor"), factor, "activeFactor")
    }

</dl>

<a class="govuk-body govuk-link" id="printLink" href="@controllers.routes.PrintController.printView" target="_blank">
    @Messages("pla.existingProtections.print") (@Messages("pla.base.newTab"))
</a>

